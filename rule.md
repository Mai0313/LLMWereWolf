# LLM Werewolf 遊戲規則

## 遊戲概要

- 本專案以狼人殺（Mafia）為基底，結合多種陣營與職業的能力，並透過 LLM 代理人進行討論與決策。
- 遊戲開始時會對所有玩家隨機分配角色，並建立內部 `GameState` 追蹤回合、階段、死亡名單與夜晚行動。
- 每個回合依序歷經夜晚行動、白天討論、白天投票，期間隨時檢查勝利條件。

## 回合流程

- **準備階段（setup）**：建立玩家物件、隨機分配角色、初始化狀態，回合數自 1 起算。
- **夜晚（night）**：具備夜間能力的角色依序行動；行動結果會暫存於 `GameState` 中，等候統一結算。
- **白天討論（day_discussion）**：公開夜晚死亡資訊並由所有存活玩家發言。
- **白天投票（day_voting）**：可投票的玩家選擇處決對象，票數最高者出局；若最高票並列則無人出局。
- **回合結束**：執行勝利檢查，若無陣營獲勝則進入下一回合夜晚，並重置夜晚／白天死亡名單與投票資料。

## 夜晚行動順序與解析

- 系統使用 `ActionPriority` 指定的優先順序進行結算，數字越大越優先：
  - `CUPID` (100): 丘比特（僅第一夜）
  - `THIEF` (95): 盜賊（僅第一夜）
  - `GUARD` (90): 守衛
  - `WEREWOLF` (80): 狼人
  - `WHITE_WOLF` (75): 白狼
  - `WITCH` (70): 女巫
  - `SEER` (60): 預言家
  - `GRAVEYARD_KEEPER` (50): 墓地守望者
  - `RAVEN` (40): 烏鴉
- 所有夜行動執行後，會統一呼叫 `resolve_deaths()` 進行死亡判定與連動效果。

## 生死結算與連動效果

- **狼人襲擊**：若目標被守衛保護或被女巫救藥鎖定，則生還；長老第一次被狼人襲擊會減少一條命並存活。
- **女巫**：救藥只能對狼人當夜的獵殺目標使用且一生一次；毒藥可對任意存活玩家使用亦僅一次，同一夜無法同時使用兩種藥水。
- **守衛**：不可連續兩晚保護同一玩家，只能阻止狼人襲擊，無法抵銷毒藥等其他來源的死亡。
- **戀人**：任一戀人死亡（含投票、毒殺、獵人或狼王開槍）時，伴侶立即因心碎身亡。
- **狼美人**：被魅惑的玩家在狼美人死亡時立刻殉情，不分白天或夜晚。
- **獵人／狼王**：當兩者死亡時，可立即選擇一名存活玩家同歸於盡（僅觸發一次），若 AI 決策失敗系統會隨機選擇目標。
- **白痴**：白天表決淘汰時翻牌並存活，但失去往後的投票權；仍可於夜晚被殺。
- **長老**：狼人第一次襲擊僅掉一條命；若被村民陣營表決處死，所有仍存活且屬村民陣營的角色能力立即失效。
- **烏鴉的詛咒**：被烏鴉標記的玩家在下一次白天投票時自帶 1 張負票，詛咒在進入下一個夜晚前重置。

## 白天流程與投票

- 白天開始時公告夜晚死亡名單；若無人死亡亦會明示。
- 討論階段由各代理人依角色背景輸出 1 至 3 句發言，供其他玩家參考。
- 投票階段僅存活且未失去投票權的玩家可投票；若無有效投票或最高票並列，視為流局。
- 騎士可在白天（投票前）發動決鬥，若對方是狼人則其身亡，否則騎士自裁。此技能目前需要介面額外觸發流程。

## 勝利條件

- **戀人勝利**：僅剩兩名戀人生存時立即獲勝（勝利判定優先度最高）。
- **狼人勝利**：存活的狼人數量大於或等於村民數量，且仍有狼人存活。
- **村民勝利**：所有狼人陣營玩家被淘汰。

## 角色能力一覽

### 村民陣營

- **Villager／村民**：無夜間能力，依靠投票與推理。
- **Seer／預言家**：每晚可查驗一名玩家陣營；隱狼遭查驗時會顯示成村民。
- **Witch／女巫**：擁有一次救藥與一次毒藥，救藥僅能對當夜狼人目標、毒藥可對任意存活玩家；同一夜不可雙用。
- **Hunter／獵人**：被淘汰時可以發動一次反擊射殺一名存活玩家。
- **Guard／守衛**：每晚守護一名玩家，不能連續守同一人，僅能阻擋狼人襲擊。
- **Idiot／白痴**：被投票淘汰時翻牌存活，但永遠失去投票權。
- **Elder／長老**：需要兩次狼人襲擊才會死亡；若白天被處決，所有村民陣營角色立即失去能力。
- **Knight／騎士**：每局一次可在白天決鬥一名玩家，命中狼人則對方死亡，否則騎士陣亡（需介面支援觸發）。
- **Magician／魔術師**：設計為每局一次夜間可交換兩名玩家角色，目前程式尚未實作能力。
- **Cupid／丘比特**：第一夜可指定兩名玩家成為戀人，戀人互通身分且生死與共。
- **Raven／烏鴉**：每晚可詛咒一名玩家，讓其在隔日投票自帶一票。
- **Graveyard Keeper／墓地守望者**：設計為可查驗死亡玩家陣營，目前程式尚未實作能力。

### 狼人陣營

- **Werewolf／狼人**：每晚與其他狼人協同選擇一名非狼人玩家進行攻擊。
- **Alpha Wolf／狼王**：具備狼人基本行動，死亡時可開槍帶走一名玩家。
- **White Wolf／白狼**：除參與群體獵殺外，在奇數回合可選擇殺害另一名狼人（可選擇放棄）。
- **Wolf Beauty／狼美人**：生涯一次可魅惑一名玩家，狼美人死亡時被魅惑者一同死亡。
- **Guardian Wolf／守護狼**：設計為可在夜晚保護一名狼人，目前程式尚未實作能力。
- **Hidden Wolf／隱狼**：被預言家查驗時會顯示為村民。
- **Blood Moon Apostle／血月使徒**：設計為條件達成時可轉化成狼人，目前程式尚未實作能力。
- **Nightmare Wolf／夢魘狼**：設計為可封鎖一名玩家當晚的技能，目前程式尚未實作能力。

### 中立陣營與狀態

- **Thief／盜賊**：第一夜可自兩張額外角色牌中擇一成為正式職業，目前程式尚未實作選擇流程。
- **Lover／戀人**：由丘比特指派的狀態，戀人彼此知情並共享勝利條件；任一方死亡時另一方立即殞命。
- **White Lover Wolf／白狼戀人**：描述當戀人組合橫跨狼人與村民時的特殊情境，目前僅作敘述性角色，尚無額外邏輯。

## 其他注意事項

- 系統會在每個階段紀錄事件日誌，供介面或教學使用。
- 每回合重新進入夜晚時會清空前一回合的臨時資料（死亡名單、票數、狼人目標、守衛保護等）。
- 若未來新增角色，需同步在 `GameConfig.role_map` 中註冊，並補齊對應的行動與結算邏輯。
